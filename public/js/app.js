!function e(t,a,i){function s(o,n){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!n&&l)return l(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=a[o]={exports:{}};t[o][0].call(u.exports,function(e){var a=t[o][1][e];return s(a?a:e)},u,u.exports,e,t,a,i)}return a[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();Object.defineProperty(a,"__esModule",{value:!0});var r=function(){function e(t){i(this,e),this.gameState=t,this.socket=new WebSocket("ws://localhost:3322/ws"),this.sessionToken=window.sessionStorage.getItem("_token");var a=this;this.socket.onmessage=function(e){var t=JSON.parse(e.data);switch(t.Type){case"xy":a.handleXyMessage(t);break;case"move_res":a.handleMoveResMessage(t);break;case"ok":console.log("server OK: "+e.data);break;default:console.log("<-recv- "+e.data),console.log("unknown command from server: "+t.Type)}},this.socket.onopen=function(){console.log("Websocket connected"),a.sessionToken?(console.log("Resuming session"),this.send("continue "+a.sessionToken)):this.send("new_player "+a.gameState.playerName)}}return s(e,[{key:"sendMove",value:function(){var e=Math.floor(this.gameState.playerGroup.x/this.gameState.tileWidth),t=Math.floor(this.gameState.playerGroup.y/this.gameState.tileHeight);(this.prevX!=e||this.prevY!=t)&&(this.socket.send("move "+e+" "+t+" "+this.sessionToken),this.prevX=e,this.prevY=t)}},{key:"handleXyMessage",value:function(e){this.gameState.spawnPlayer(e),this.sessionToken=e.Token,window.sessionStorage.setItem("_token",e.Token)}},{key:"handleMoveResMessage",value:function(e){this.gameState.renderLocalSpawns(e.LocalSpawns)}}]),e}();a["default"]=r},{}],2:[function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();Object.defineProperty(a,"__esModule",{value:!0});var l=e("./Client.js"),h=i(l),u=function(e){function t(){return s(this,t),r(this,Object.getPrototypeOf(t).apply(this,arguments))}return o(t,e),n(t,[{key:"preload",value:function(){this.game.time.advancedTiming=!0,this.game.stage.backgroundColor="#262f71",this.game.load.tilemap("islandMap","/island/full",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("ground","img/tileset/oddball/ground.png",4,8),this.game.load.image("minimap","img/islands/current.png"),this.game.load.atlas("characterAtlas","img/tileset/oddball/characters.png","sprite/character"),this.game.load.atlas("itemAtlas","img/tileset/oddball/items.png","sprite/item"),this.game.load.atlas("ground2Atlas","img/tileset/oddball/ground2.png","sprite/ground2"),this.game.load.spritesheet("button","img/tileset/ui/buttons.png",27,24),this.game.load.image("oddballFont","img/tileset/oddball/font.png"),this.game.load.audio("bgSound",["audio/dead_feelings.mp3"])}},{key:"create",value:function(){this.playerName="Jimpson",this.worldScale=1,this.tileWidth=8,this.tileHeight=4,this.logMessages=[{text:"hello there",time:1222},{text:"later on",time:1234}],this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.scale.setGameSize(window.innerWidth,window.innerHeight),this.music=this.game.add.audio("bgSound"),this.music.volume=.2,this.stageGroup=this.game.add.group(),this.groundMap=this.game.add.tilemap("islandMap"),this.groundMap.addTilesetImage("island_tiles","ground"),this.groundMap.setCollisionBetween(0,112),this.groundLayer=this.groundMap.createLayer(0),this.groundLayer.resizeWorld(),this.stageGroup.add(this.groundLayer),this.playerGroup=this.game.add.group(),this.game.camera.follow(this.playerGroup),this.stageGroup.add(this.playerGroup),this.spawnLayer=this.game.add.group(),this.stageGroup.add(this.spawnLayer),this.initUi(),this.client=new h["default"](this),this.redrawLogMessages()}},{key:"update",value:function(){if(this.playerSprite){this.game.physics.arcade.collide(this.playerGroup,this.groundLayer);var e=1,t=e/2;this.cursors.up.isDown?(this.playerGroup.y-=t,this.client.sendMove()):this.cursors.down.isDown&&(this.playerGroup.y+=t,this.client.sendMove()),this.cursors.left.isDown?(this.playerGroup.x-=e,this.client.sendMove()):this.cursors.right.isDown&&(this.playerGroup.x+=e,this.client.sendMove()),this.game.input.keyboard.isDown(Phaser.Keyboard.Q)?this.worldScale+=.05:this.game.input.keyboard.isDown(Phaser.Keyboard.A)&&(this.worldScale-=.05),this.worldScale=Phaser.Math.clamp(this.worldScale,.5,4),this.stageGroup.scale.set(this.worldScale)}}},{key:"render",value:function(){this.game.debug.text(this.game.time.fps||"--",1,14,"#00ff00")}},{key:"initUi",value:function(){this.cursors=this.game.input.keyboard.createCursorKeys();var e=3,t=this.game.width-this.game.cache.getImage("minimap").width/e;this.minimap=this.game.add.sprite(t,0,"minimap"),this.minimap.fixedToCamera=!0,this.minimap.scale.set(1/e),this.minimap.alpha=.8,this.minimap.setScaleMinMax(1/e,1/e);var a=this.game.add.button(this.game.width-102,2,"button",function(){this.music.isPlaying?this.music.stop():this.music.play()},this,0,0,0);a.fixedToCamera=!0}},{key:"spawnPlayer",value:function(e){this.playerSprite=this.game.add.sprite(0,0,"characterAtlas"),this.playerSprite.frameName="dwarf",this.playerSprite.anchor.set(.5),this.playerGroup.x=e.X*this.tileWidth,this.playerGroup.y=e.Y*this.tileHeight,this.playerGroup.add(this.playerSprite);var t=this.makeText(this.playerName),a=this.game.add.image(0,-10,t);a.anchor.set(.5),this.playerGroup.add(a),console.log("spawned at "+e.X+", "+e.Y),this.game.physics.enable(this.playerGroup),this.renderLocalSpawns(e.LocalSpawns)}},{key:"renderLocalSpawns",value:function(e){this.spawnLayer.removeAll();for(var t="",a=0;a<e.length;a++){var i=e[a];if("player"!=i.Class||i.Name!=this.playerName){var s=i.Sprite.split(":");switch(s[0]){case"c":t="characterAtlas";break;case"i":t="itemAtlas";break;case"g":t="ground2Atlas";break;default:console.log("ERROR unknown sprite: "+i.Sprite),console.log(i);continue}var r=this.game.add.sprite(0,0,t);r.x=i.X*this.tileWidth,r.y=i.Y*this.tileHeight,r.frameName=s[1],r.anchor.set(.5),this.spawnLayer.add(r)}}}},{key:"makeText",value:function(e){var t="                                !\"#$%&'()  ,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",a=this.game.add.retroFont("oddballFont",8,8,t,16);return a.autoUpperCase=!1,a.text=e,a}},{key:"redrawLogMessages",value:function(){this.logMessageWindow=this.game.add.group(),this.logMessageWindow.x=100,this.logMessageWindow.y=100,this.logMessageWindow.z=20,this.logMessageWindow.fixedToCamera=!0;var e=!0,t=!1,a=void 0;try{for(var i,s=this.logMessages[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value;console.log(r);var o=this.makeText(r.text),n=this.game.add.image(0,-10,o);this.logMessageWindow.add(n)}}catch(l){t=!0,a=l}finally{try{!e&&s["return"]&&s["return"]()}finally{if(t)throw a}}}},{key:"updateShadowTexture",value:function(){this.shadowTexture.context.fillStyle="rgb(100, 100, 100)",this.shadowTexture.context.fillRect(0,0,this.game.width,this.game.height);var e=this.shadowTexture.context.createRadialGradient(this.playerGroup.x,this.playerGroup.y,.75*this.LIGHT_RADIUS,this.playerGroup.x,this.playerGroup.y,this.LIGHT_RADIUS);e.addColorStop(0,"rgba(255, 255, 255, 1.0)"),e.addColorStop(1,"rgba(255, 255, 255, 0.0)"),this.shadowTexture.context.beginPath(),this.shadowTexture.context.fillStyle=e,this.shadowTexture.context.arc(this.playerGroup.x,this.playerGroup.y,this.LIGHT_RADIUS,0,2*Math.PI),this.shadowTexture.context.fill(),this.shadowTexture.dirty=!0}}]),t}(Phaser.State);a["default"]=u},{"./Client.js":1}],3:[function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=e("./GameState.js"),l=i(n),h=function(e){function t(){s(this,t);var e=r(this,Object.getPrototypeOf(t).call(this,800,400,Phaser.CANVAS,"content",null,!1,!1));return e.state.add("GameState",l["default"],!1),e.state.start("GameState"),e}return o(t,e),t}(Phaser.Game);new h},{"./GameState.js":2}]},{},[3]);
//# sourceMappingURL=app.js.map
